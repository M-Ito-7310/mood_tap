# MoodTap Testing Guide

このドキュメントは、MoodTapアプリケーションのテスト手順を説明します。

## 📋 目次

1. [自動テスト](#自動テスト)
2. [アクセシビリティテスト](#アクセシビリティテスト)
3. [クロスブラウザテスト](#クロスブラウザテスト)
4. [モバイルデバイステスト](#モバイルデバイステスト)
5. [キーボードナビゲーションテスト](#キーボードナビゲーションテスト)

## 🧪 自動テスト

### ユニットテストの実行

```bash
# すべてのテストを実行
npm test

# ウォッチモードでテスト実行
npm test -- --watch

# カバレッジレポート付きでテスト実行
npm run test:coverage

# UIモードでテスト実行
npm run test:ui
```

### タイプチェック

```bash
npm run type-check
```

### テスト対象

- ✅ `lib/stats.ts` - 統計計算関数
  - 平均気分スコア計算
  - 気分の最高値・最低値取得
  - 連続記録日数計算
  - 週次データ生成
- ✅ `lib/constants.ts` - 定数値の検証

## ♿ アクセシビリティテスト

### ESLint アクセシビリティチェック

プロジェクトには `eslint-plugin-jsx-a11y` が設定されています。

```bash
npx next lint
```

### WCAG 2.1 準拠チェックリスト

#### ✅ 実装済み項目

- **1.1.1 非テキストコンテンツ**: すべての絵文字に `aria-label` 属性を追加
- **1.3.1 情報と関係性**: セマンティックHTML要素の使用（`<nav>`, `<section>`, `<header>`）
- **2.1.1 キーボード操作**: すべての機能をキーボードで操作可能
- **2.4.4 リンクの目的**: すべてのナビゲーションリンクに明確な `aria-label`
- **3.2.3 一貫したナビゲーション**: 固定フッターナビゲーション
- **4.1.2 名前・役割・値**: ARIA属性の適切な使用

#### 🔍 手動確認が必要な項目

1. **色のコントラスト比** (WCAG AA: 4.5:1以上)
   - Chrome DevToolsのLighthouseで確認
   - [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)で確認

2. **スクリーンリーダーテスト**
   - Windows: NVDA または Narrator
   - macOS: VoiceOver
   - 確認内容:
     - ページタイトルが適切に読み上げられるか
     - ボタンの目的が明確か
     - フォームフィールドのラベルが適切か

## 🌐 クロスブラウザテスト

### テスト対象ブラウザ

#### デスクトップ

| ブラウザ | バージョン | 優先度 | テスト項目 |
|---------|-----------|--------|-----------|
| Chrome | 最新版 | 🔴 必須 | フル機能テスト |
| Firefox | 最新版 | 🔴 必須 | フル機能テスト |
| Edge | 最新版 | 🟡 推奨 | 基本機能テスト |
| Safari | 最新版 | 🟡 推奨 | 基本機能テスト |

#### モバイル

| ブラウザ | OS | 優先度 | テスト項目 |
|---------|-----|--------|-----------|
| Chrome Mobile | Android 10+ | 🔴 必須 | フル機能テスト |
| Safari Mobile | iOS 14+ | 🔴 必須 | フル機能テスト |
| Firefox Mobile | Android 10+ | 🟢 任意 | 基本機能テスト |

### テスト手順

#### 1. 基本機能テスト

- [ ] ページが正常に読み込まれる
- [ ] 気分ボタンをタップ/クリックできる
- [ ] 気分が正常に保存される
- [ ] 保存された気分が履歴に表示される
- [ ] カレンダー表示が正常に動作する
- [ ] 統計ページが正常に表示される

#### 2. PWA機能テスト

- [ ] オフラインで動作する
- [ ] ホーム画面に追加できる
- [ ] インストール後、スタンドアロンで起動できる
- [ ] サービスワーカーが正常に動作する

#### 3. レスポンシブデザインテスト

- [ ] 320px幅（iPhone SE）で正常に表示される
- [ ] 768px幅（タブレット）で正常に表示される
- [ ] 1024px以上（デスクトップ）で正常に表示される

### ブラウザ固有のテストポイント

#### Safari (iOS/macOS)

- [ ] IndexedDBが正常に動作する
- [ ] ハプティックフィードバックが動作する（iOS）
- [ ] PWAとしてインストールできる
- [ ] 日付処理が正常に動作する（タイムゾーン）

#### Firefox

- [ ] CSS Gridレイアウトが正常に表示される
- [ ] アニメーションが滑らかに動作する
- [ ] IndexedDBの永続化が動作する

#### Edge

- [ ] Chromiumベースの機能がすべて動作する
- [ ] Windows統合機能（通知など）が動作する

## 📱 モバイルデバイステスト

### 実機テスト推奨デバイス

1. **iPhone** (iOS 14+)
   - Safari Mobile
   - PWAインストール
   - ハプティックフィードバック
   - タッチジェスチャー

2. **Android** (Android 10+)
   - Chrome Mobile
   - PWAインストール
   - タッチジェスチャー

### Chrome DevToolsでのエミュレーション

```bash
# 開発サーバーを起動
npm run dev
```

1. Chrome DevToolsを開く (F12)
2. デバイスツールバーを有効化 (Ctrl+Shift+M)
3. テストデバイスを選択:
   - iPhone 12 Pro
   - iPhone SE
   - Pixel 5
   - iPad Air
   - Galaxy S20

### モバイル固有のテスト項目

- [ ] タップターゲットのサイズが十分（44x44px以上）
- [ ] スクロールが滑らか
- [ ] ピンチズームが無効化されている（PWA仕様）
- [ ] ソフトキーボード表示時のレイアウト
- [ ] オリエンテーション変更時の挙動
- [ ] タッチジェスチャーの応答性

## ⌨️ キーボードナビゲーションテスト

### ショートカットキー

| キー | 機能 |
|------|------|
| `1-5` | 気分を選択（ホームページ） |
| `Tab` | 次の要素にフォーカス |
| `Shift+Tab` | 前の要素にフォーカス |
| `Enter` / `Space` | ボタンをアクティブ化 |

### テスト手順

1. **Tab順序の確認**
   - [ ] 論理的な順序でフォーカスが移動する
   - [ ] すべてのインタラクティブ要素にアクセスできる
   - [ ] フォーカス表示が明確に見える

2. **数字キーショートカット**
   - [ ] `1`: terrible の気分を記録
   - [ ] `2`: bad の気分を記録
   - [ ] `3`: okay の気分を記録
   - [ ] `4`: good の気分を記録
   - [ ] `5`: great の気分を記録

3. **Enter/Spaceキー**
   - [ ] ボタンがアクティブ化される
   - [ ] リンクが開く

4. **Escapeキー**
   - [ ] モーダルが閉じる（該当する場合）

## 🔧 デバッグツール

### Chrome DevTools Lighthouse

```
1. Chrome DevToolsを開く
2. Lighthouseタブを選択
3. カテゴリを選択:
   - Performance
   - Accessibility
   - Best Practices
   - SEO
   - PWA
4. "Generate report" をクリック
```

### アクセシビリティ監査ツール

- [axe DevTools](https://www.deque.com/axe/devtools/) - Chrome/Firefox拡張機能
- [WAVE](https://wave.webaim.org/) - Webアクセシビリティ評価ツール
- [Accessibility Insights](https://accessibilityinsights.io/) - Microsoft製ツール

## 📊 テスト結果の記録

各テストセッション後、以下の情報を記録してください:

```markdown
### テスト日: YYYY-MM-DD

**環境:**
- ブラウザ: [名前とバージョン]
- OS: [名前とバージョン]
- デバイス: [デバイス名]

**結果:**
- 合格: [数]
- 不合格: [数]
- 未実施: [数]

**不具合:**
1. [不具合の説明]
2. [不具合の説明]

**備考:**
[追加のコメント]
```

## 🚀 継続的なテスト

### CI/CDパイプラインでの自動テスト

将来的に実装を検討:

- GitHub Actions で自動テスト実行
- Playwright でE2Eテスト
- Visual Regression Testing
- Performance budgets

---

**最終更新:** 2025-10-24
**テストカバレッジ:** 統計関数 100%
