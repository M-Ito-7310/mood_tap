# Phase 9: PWA対応

**作成日**: 2025年10月23日
**Phase**: 9/12
**所要時間**: 30-45分
**前提条件**: Phase 1-8完了

---

## Phase概要

### 目的
Progressive Web App (PWA)として動作するよう設定し、オフライン利用とホーム画面追加を可能にする。

### 成果物
- `public/manifest.json`: PWAマニフェスト
- Service Worker設定
- アイコンセット
- オフライン対応

---

## 実装タスク詳細

### タスク1: マニフェスト作成 (10分)

#### ファイル: `public/manifest.json`

```json
{
  "name": "MoodTap - 1タップ気分記録",
  "short_name": "MoodTap",
  "description": "1日1回、気分を5段階でタップするだけ。セルフケアを習慣化するアプリ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#FFFFFF",
  "theme_color": "#3B82F6",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "categories": ["health", "lifestyle", "productivity"],
  "lang": "ja",
  "dir": "ltr"
}
```

### タスク2: Next.js PWA設定 (15分)

#### パッケージインストール

```bash
npm install next-pwa
```

#### ファイル: `next.config.js`

```javascript
/** @type {import('next').NextConfig} */
const withPWA = require('next-pwa')({
  dest: 'public',
  disable: process.env.NODE_ENV === 'development',
  register: true,
  skipWaiting: true,
});

const nextConfig = {
  reactStrictMode: true,
};

module.exports = withPWA(nextConfig);
```

### タスク3: レイアウト更新 (10分)

#### ファイル: `app/layout.tsx` (metadata更新)

```typescript
export const metadata: Metadata = {
  title: 'MoodTap - 1タップ気分記録',
  description: '1日1回、気分を5段階でタップするだけ。セルフケアを習慣化するアプリ',
  keywords: 'メンタルヘルス, 気分記録, セルフケア, 習慣化, PWA',
  authors: [{ name: 'MoodTap Team' }],
  viewport: 'width=device-width, initial-scale=1, maximum-scale=1',
  themeColor: '#3B82F6',
  manifest: '/manifest.json',
  appleWebApp: {
    capable: true,
    statusBarStyle: 'default',
    title: 'MoodTap',
  },
};
```

### タスク4: アイコン生成

PWAアイコンは以下のツールで生成:
- https://www.pwabuilder.com/imageGenerator
- または https://realfavicongenerator.net/

必要サイズ: 72, 96, 128, 144, 152, 192, 384, 512px

---

## チェックリスト

- [ ] manifest.jsonが作成されている
- [ ] Service Workerが登録される
- [ ] ホーム画面に追加できる
- [ ] オフライン動作する
- [ ] アイコンが正しく表示される

---

## トラブルシューティング

### 問題: Service Workerが登録されない

**解決策:**
```bash
# ビルド後に確認
npm run build
npm start

# ブラウザDevToolsでチェック
Application > Service Workers
```

---

## 次のPhaseへの接続

Phase 10でデータエクスポート機能を実装します。

---

**ドキュメント作成者**: AI Agent (Claude)
**最終更新日**: 2025年10月23日
**バージョン**: 1.0
